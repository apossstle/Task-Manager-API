<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Task Manager</title>
</head>
<body>

<h2>Регистрация</h2>
<input id="reg-email" placeholder="email">
<input id="reg-pass" placeholder="password">
<button onclick="register()">Register</button>

<h2>Логин</h2>
<input id="login-email" placeholder="email">
<input id="login-pass" placeholder="password">
<button onclick="login()">Login</button>

<h2>Задачи</h2>
<input id="task-title" placeholder="task title">
<button onclick="createTask()">Add task</button>

<ul id="tasks"></ul>

<script>
let token = null;

function el(id) {
  return document.getElementById(id);
}

async function register() {
  const res = await fetch("http://127.0.0.1:8000/users/register", {
    method: "POST",
    headers: {"Content-Type": "application/json"},
    body: JSON.stringify({
      email: el("reg-email").value,
      password: el("reg-pass").value
    })
  });
  alert(await res.text());
}

async function login() {
  const res = await fetch("http://127.0.0.1:8000/users/login", {
    method: "POST",
    headers: {"Content-Type": "application/json"},
    body: JSON.stringify({
      email: el("login-email").value,
      password: el("login-pass").value
    })
  });

  const data = await res.json();
  token = data.access_token;
  loadTasks();
}

async function loadTasks() {
  const res = await fetch("http://127.0.0.1:8000/tasks", {
    headers: {
      "Authorization": "Bearer " + token
    }
  });

  const tasks = await res.json();
  const ul = el("tasks");
  ul.innerHTML = "";

  tasks.forEach(t => {
    const li = document.createElement("li");
    li.innerText = t.title;
    ul.appendChild(li);
  });
}

async function createTask() {
  await fetch("http://127.0.0.1:8000/tasks", {
    method: "POST",
    headers: {
      "Content-Type": "application/json",
      "Authorization": "Bearer " + token
    },
    body: JSON.stringify({
      title: el("task-title").value
    })
  });
  loadTasks();
}
</script>

</body>
</html>
